# GitReport - 基于 Git 记录的自动化总结报告生成工具

## 项目概述

**产品定位**：纯前端桌面应用（无服务端）

**技术栈**：Tauri + React 18 + TypeScript + Tailwind CSS

**核心功能**：自动读取本地 Git 提交记录（含子模块），结合用户自定义 LLM 模型，生成日报/周报/月报/季报/年报

**解决痛点**：
- 跨项目提交记录总结不便
- 凌晨提交时间计算错位（跨天统计）
- 手动整理工作内容耗时费力

---

## 一、技术架构（纯前端无服务端）

### 1.1 架构分层

| 分层 | 技术选型 | 核心作用 |
|------|---------|---------|
| **前端 UI** | React 18 + TypeScript + Tailwind CSS | 界面交互、用户操作、LLM API 直连调用 |
| **本地桥接** | Tauri（Rust） | 本地能力桥接：调用 Git 命令行、读写本地文件，无服务端逻辑 |
| **数据存储** | 本地 JSON 文件 | 保存全局配置、项目配置、历史报告，适配 Windows/macOS |
| **外部依赖** | Git 命令行、LLM API | Git 日志读取依赖本地 Git 环境，总结生成依赖用户配置的 LLM 接口（前端直连） |

### 1.2 数据流向

```
用户操作（前端 UI）
    ↓
Tauri 桥接层（调用本地 Git 命令）
    ↓
解析 Git 提交记录
    ↓
拼接 Prompt + 前端直连 LLM API
    ↓
流式返回总结报告
    ↓
本地保存（JSON 文件）
```

---

## 二、核心功能模块

### 2.1 桌面悬浮球（核心入口）

| 交互行为 | 功能描述 |
|---------|---------|
| **右键点击** | 弹出核心菜单：总结报告、添加/合并总结项目、设置 |
| **左键单击** | 快速打开最近一次生成的总结报告 |
| **拖拽移动** | 支持在桌面自由拖动，记忆上次位置（默认右上角） |
| **双击** | 一键生成今日日报（使用默认配置） |
| **样式适配** | 半透明圆形图标，支持自定义大小/透明度，适配系统暗色模式 |

### 2.2 项目管理（纯本地配置）

| 功能点 | 详细要求 |
|--------|---------|
| **项目添加** | 手动输入/拖拽文件夹导入项目名称、本地 Git 仓库路径 |
| **子模块识别** | 自动识别仓库下的子模块，支持勾选是否纳入总结范围 |
| **提交人筛选** | 读取 Git 提交记录中的所有作者，支持多选、模糊搜索 |
| **项目配置独立保存** | 每个项目关联独立的 LLM 配置、时间范围、跨天选项等 |
| **配置操作** | 支持项目的编辑/删除/导出（本地 JSON）/导入 |

### 2.3 Git 日志读取（纯本地执行）

| 功能点 | 详细要求 |
|--------|---------|
| **命令调用** | 通过 Tauri 调用本地 `git log` 命令，指定时间范围、提交人、子模块参数 |
| **日志解析** | 提取提交哈希、作者、时间、提交信息、修改文件等核心字段 |
| **时间范围** | 预设：今日/昨日/本周/本月/本季度/本年度；支持自定义时间范围 |
| **跨天统计（核心）** | 开启后"今日"范围为「前一天 0:00 - 当前时间」，解决凌晨提交统计问题 |
| **容错处理** | 检测本地 Git 是否安装（未安装则提示下载）；仓库路径错误/无提交记录友好提示 |

### 2.4 LLM 总结生成（前端直连 API）

#### LLM 配置参数

| 配置项 | 说明 |
|-------|------|
| **API Key** | 用户自定义 LLM API 密钥（本地加密存储） |
| **API Base URL** | 自定义接口地址（如 OpenAI、国内 LLM 服务） |
| **模型名称** | 如 `gpt-3.5-turbo`、`gpt-4` 等 |
| **请求超时时间** | 默认 30 秒，可自定义 |
| **温度（Temperature）** | 0-1 之间，控制生成随机性 |

#### 总结配置

| 配置项 | 可选值 |
|-------|--------|
| **报告类型** | 日报/周报/月报/季报/年报 |
| **输出格式** | Markdown/纯文本 |
| **语气风格** | 正式/简洁/口语化 |
| **默认字数** | 日报 300 字、周报 800 字、月报 1500 字、季报 3000 字、年报 5000 字 |

#### 生成流程

1. 前端将解析后的 Git 记录拼接为 Prompt
2. 直连 LLM API 发起请求
3. 流式展示生成过程，支持暂停/取消
4. 生成后可编辑、复制到剪贴板、导出为 Markdown/PDF

### 2.5 本地配置与存储

| 配置类型 | 存储路径 | 核心内容 |
|---------|---------|---------|
| **全局配置** | Windows: `%APPDATA%/git-report/config.json`<br>macOS: `~/Library/Application Support/git-report/config.json` | 悬浮球位置/大小/透明度、各报告默认字数、跨天默认状态、暗色模式配置 |
| **项目配置** | 同上（嵌套在全局配置中） | 项目名称、仓库路径、提交人、LLM 配置、子模块勾选状态 |
| **历史报告** | Windows: `%APPDATA%/git-report/reports/`<br>macOS: `~/Library/Application Support/git-report/reports/` | 按时间/项目分类保存生成的报告，支持删除/清空 |
| **安全处理** | - | API Key 本地 Base64 加密存储，支持手动编辑配置文件 |

### 2.6 辅助功能

| 功能点 | 详细要求 |
|--------|---------|
| **快捷键支持** | `Ctrl/Cmd + Shift + G`：快速打开总结报告生成页<br>`Ctrl/Cmd + Shift + S`：打开设置页 |
| **操作日志** | 本地保存操作日志（如 Git 命令执行失败、LLM 调用错误），便于排查问题 |
| **版本更新** | 前端直连 GitHub Release 检查更新，提示用户手动下载安装 |
| **首次启动引导** | 引导用户添加第一个项目、配置 LLM 参数，降低使用门槛 |

---

## 三、界面原型设计

### 3.1 悬浮球 + 右键菜单

```
┌─────────┐
│ 🔵      │  ← 桌面悬浮球（可拖拽）
└─────────┘
    │
    ▼ 右键菜单
┌─────────────────────────────┐
│ 📄 总结报告                 │
│  ├─ 今日日报（跨天：开启）  │
│  ├─ 本周周报                │
│  ├─ 自定义时间              │
│  └─ 历史报告                │
├─────────────────────────────┤
│ 📦 添加/合并总结项目        │
│  ├─ 添加新项目              │
│  ├─ 合并选中项目            │
│  └─ 项目管理                │
├─────────────────────────────┤
│ ⚙️ 设置                     │
└─────────────────────────────┘
```

### 3.2 项目添加页

```
┌───────────────────────────────────────────────────────────────┐
│ 添加Git项目                                    [关闭] [保存] │
├───────────────────────────────────────────────────────────────┤
│ 项目名称：[电商后台项目_________________________]              │
│ 仓库路径：[📁 /Users/xxx/projects/shop-admin____] (拖拽文件夹) │
│                                                               │
│ 🔍 已识别子模块：                                             │
│   ☑️ shop-admin-api (路径：/Users/xxx/projects/shop-admin/api) │
│   ☑️ shop-admin-web (路径：/Users/xxx/projects/shop-admin/web) │
│                                                               │
│ Git提交人（多选）：                                           │
│ [√] 张三 <zhangsan@xxx.com>  [√] 李四 <lisi@xxx.com>          │
│ [ ] 王五 <wangwu@xxx.com>                                     │
│                                                               │
│ LLM配置（本地保存，加密存储）：                               │
│ API Key：[*****************************]                     │
│ Base URL：[https://api.openai.com/v1____________________]     │
│ 模型名称：[gpt-3.5-turbo___________________________]         │
└───────────────────────────────────────────────────────────────┘
```

### 3.3 总结生成页

```
┌───────────────────────────────────────────────────────────────┐
│ 生成日报 - 电商后台项目 (2026-02-27)          [返回] [导出]   │
├───────────────────────────────────────────────────────────────┤
│ 基础设置：                                                    │
│ 时间范围：[今日] ▼  [√] 跨天统计（前一天0:00-当前时间）       │
│ 报告类型：[日报] ▼  字数要求：[300] 字      语气：[正式] ▼   │
│                                                               │
│ 📜 Git记录预览（本地解析）：                                  │
│ 1. feat(登录): 实现手机号验证码登录（张三 2026-02-27 00:30）  │
│ 2. fix(订单): 修复订单支付状态同步问题（李四 2026-02-26 23:10）│
│ [刷新] [编辑]                                                 │
│                                                               │
│ 🚀 生成结果（前端直连LLM）：                                  │
│ # 2026-02-27 日报（电商后台项目）                            │
│ ## 核心工作内容                                               │
│ 1. 登录模块：完成手机号验证码登录功能开发，适配了不同运营商的 │
│    验证码格式，提升用户登录体验。                             │
│ 2. 订单模块：修复订单支付状态同步延迟问题，优化了数据库查询语 │
│    句，减少接口响应时间约20%。                                │
│                                                               │
│ [复制到剪贴板] [导出为Markdown] [导出为PDF]                  │
└───────────────────────────────────────────────────────────────┘
```

### 3.4 设置页

```
┌───────────────────────────────────────────────────────────────┐
│ 设置                                    [保存] [恢复默认]    │
├───────────────────────────────────────────────────────────────┤
│ 悬浮球设置：                                                  │
│ 大小：[50] px  透明度：[80] %  初始位置：[右上角] ▼           │
│                                                               │
│ 报告默认配置：                                                │
│ 日报：[300] 字  周报：[800] 字  月报：[1500] 字              │
│ 季报：[3000] 字  年报：[5000] 字                              │
│                                                               │
│ 全局设置：                                                    │
│ [√] 启动时自动显示悬浮球  [√] 默认开启跨天统计                │
│ [√] 保存生成的报告到本地  [√] 暗色模式跟随系统                │
│                                                               │
│ 本地存储路径：                                                │
│ 配置文件：~/Library/Application Support/git-report/config.json│
│ 报告文件：~/Library/Application Support/git-report/reports/   │
└───────────────────────────────────────────────────────────────┘
```

---

## 四、技术实现要点

### 4.1 Git 命令调用示例

```bash
# 读取指定时间范围的提交记录
git log --since="2026-02-26 00:00:00" --until="2026-02-27 23:59:59" \
  --author="张三\|李四" \
  --pretty=format:"%H|%an|%ae|%ai|%s" \
  --name-status

# 读取子模块提交记录
git submodule foreach --recursive \
  'git log --since="2026-02-26 00:00:00" --until="2026-02-27 23:59:59" \
   --pretty=format:"%H|%an|%ae|%ai|%s"'
```

### 4.2 Prompt 模板示例

```
你是一个专业的工作总结助手。请根据以下 Git 提交记录，生成一份 {reportType}（{wordCount} 字左右，语气：{tone}）。

## Git 提交记录
{gitCommits}

## 要求
- 按模块分类整理
- 突出核心工作内容
- 使用 Markdown 格式
- 语气{tone}，字数控制在 {wordCount} 字左右
```

### 4.3 数据结构示例

```typescript
// 全局配置
interface GlobalConfig {
  floatingBall: {
    size: number;          // 大小（px）
    opacity: number;       // 透明度（0-100）
    position: {x: number; y: number}; // 位置
  };
  reports: {
    daily: number;         // 日报默认字数
    weekly: number;        // 周报默认字数
    monthly: number;       // 月报默认字数
    quarterly: number;     // 季报默认字数
    yearly: number;        // 年报默认字数
  };
  crossDay: boolean;       // 默认是否开启跨天统计
  darkMode: boolean;       // 是否跟随系统暗色模式
  projects: ProjectConfig[]; // 项目配置列表
}

// 项目配置
interface ProjectConfig {
  id: string;              // 项目唯一 ID
  name: string;            // 项目名称
  repoPath: string;        // 仓库路径
  authors: string[];       // 提交人列表
  submodules: {
    path: string;
    enabled: boolean;      // 是否纳入统计
  }[];
  llm: {
    apiKey: string;        // Base64 加密存储
    baseUrl: string;
    model: string;
    timeout: number;
    temperature: number;
  };
}

// Git 提交记录
interface GitCommit {
  hash: string;            // 提交哈希
  author: string;          // 作者名称
  email: string;           // 作者邮箱
  date: string;            // 提交时间
  message: string;         // 提交信息
  files: {
    status: 'A' | 'M' | 'D'; // 文件状态（新增/修改/删除）
    path: string;          // 文件路径
  }[];
}
```

---

## 五、开发优先级

### P0（核心功能，必须实现）

1. 桌面悬浮球（右键菜单、拖拽、位置记忆）
2. 项目添加（手动输入仓库路径、子模块识别）
3. Git 日志读取（本地命令调用、时间范围筛选）
4. LLM 总结生成（前端直连 API、流式展示）
5. 本地配置存储（全局配置、项目配置、历史报告）

### P1（重要功能，优先实现）

1. 跨天统计（凌晨提交时间修正）
2. 提交人筛选（多选、模糊搜索）
3. 报告导出（Markdown/PDF）
4. 快捷键支持（快速打开页面）
5. 首次启动引导

### P2（辅助功能，可延后实现）

1. 操作日志记录
2. 版本更新检查
3. 暗色模式适配
4. 历史报告管理（删除/清空）
5. 配置导入/导出

---

## 六、用户使用流程

### 首次使用

1. 启动应用 → 显示首次启动引导
2. 添加第一个项目（输入仓库路径、选择提交人）
3. 配置 LLM 参数（API Key、Base URL、模型名称）
4. 生成第一份日报（验证配置是否正确）

### 日常使用

**方式一：快捷生成**
- 双击桌面悬浮球 → 自动生成今日日报（使用默认配置）

**方式二：自定义生成**
- 右键悬浮球 → 总结报告 → 选择报告类型（日报/周报等）
- 调整时间范围、字数、语气等参数
- 预览 Git 记录 → 点击生成 → 复制/导出

**方式三：快捷键**
- `Ctrl/Cmd + Shift + G` → 打开总结报告生成页
- 快速调整参数后生成

### 多项目管理

1. 右键悬浮球 → 添加/合并总结项目 → 添加新项目
2. 生成报告时选择「合并选中项目」
3. 自动合并多个项目的 Git 记录生成统一报告

---

## 七、安全与隐私

| 方面 | 措施 |
|------|------|
| **API Key 安全** | 本地 Base64 加密存储，不上传任何服务器 |
| **数据隐私** | 所有 Git 记录和报告仅存储在本地，不上传云端 |
| **LLM 调用** | 前端直连用户自定义的 LLM API，应用不经手任何数据 |
| **配置安全** | 支持手动编辑配置文件，用户完全掌控数据 |
| **开源透明** | 代码开源，用户可自行审查安全性 |

---

## 八、技术难点与解决方案

| 难点 | 解决方案 |
|------|---------|
| **子模块识别** | 使用 `git submodule status` 命令读取子模块列表 |
| **跨天统计** | 检测当前时间，若在 0:00-当前时间之间，则将时间范围调整为「前一天 0:00 - 当前时间」 |
| **LLM 流式输出** | 使用 SSE（Server-Sent Events）或 WebSocket 接收流式响应 |
| **Markdown 导出** | 使用 `markdown-it` 库生成 HTML，再通过 `html2pdf` 转换为 PDF |
| **跨平台路径** | 使用 Tauri 的 `path` API 自动适配 Windows/macOS 路径 |
| **Git 环境检测** | 启动时调用 `git --version`，若失败则提示安装 Git |

---

## 九、未来扩展方向

1. **团队协作**：支持团队多人 Git 记录合并总结
2. **自定义模板**：支持用户自定义 Prompt 模板
3. **数据可视化**：生成提交统计图表（按时间、模块、提交人分类）
4. **语音播报**：生成报告后支持语音朗读
5. **多语言支持**：界面和报告支持中文/英文切换
6. **云端同步**：支持配置和报告的云端备份（可选）
